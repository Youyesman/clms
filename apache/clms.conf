# 필요한 모듈 로드 (이미 로드되어 있을 수 있으나 명시적으로 확인)
LoadModule proxy_module modules/mod_proxy.so
LoadModule proxy_http_module modules/mod_proxy_http.so
LoadModule rewrite_module modules/mod_rewrite.so
LoadModule headers_module modules/mod_headers.so

<VirtualHost *:80>
    ServerName localhost
    
    # 1. API 요청 -> Backend (Django)
    <Location "/Api">
        Header set Cache-Control "no-store, no-cache, must-revalidate, max-age=0"
        Header set Pragma "no-cache"
    </Location>
    ProxyPass /Api http://backend:8000/Api
    ProxyPassReverse /Api http://backend:8000/Api

    # 2. Admin 요청 -> Backend (Django)
    ProxyPass /admin/ http://backend:8000/admin/
    ProxyPassReverse /admin/ http://backend:8000/admin/

    # 3. Static Files (Django에서 collectstatic한 파일들)
    # 볼륨 마운트된 경로를 Alias로 지정
    Alias /static/ /app/static/
    <Directory "/app/static/">
        Options Indexes FollowSymLinks
        AllowOverride None
        Require all granted
    </Directory>

    # 4. Media Files (사용자 업로드 파일)
    Alias /media/ /app/media/
    <Directory "/app/media/">
        Options Indexes FollowSymLinks
        AllowOverride None
        Require all granted
    </Directory>

    # 5. 그 외 모든 요청 -> Frontend (React Container)
    ProxyPass / http://frontend:80/
    ProxyPassReverse / http://frontend:80/
    
    # 프록시 보존 설정
    ProxyPreserveHost On
</VirtualHost>
